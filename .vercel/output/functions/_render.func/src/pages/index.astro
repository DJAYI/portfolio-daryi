---
// Página selector de idioma — punto de entrada principal
// Server-rendered para detectar Accept-Language del navegador
export const prerender = false;

import "../styles/global.css";

const SITE_URL = "https://portfolio-daryi.vercel.app";

// Detectar idioma preferido del navegador vía Accept-Language (server-side)
const preferredLocale = Astro.preferredLocale;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Danilo Arenas Yi — Fullstack Developer Portfolio</title>
    <meta
      name="description"
      content="Fullstack Developer Portfolio of Danilo Arenas Yi (DJAYI). Specializing in React, Laravel, TypeScript. Choose your preferred language."
    />
    <meta
      name="keywords"
      content="Danilo Arenas Yi, DJAYI, Fullstack Developer, Portfolio, Software Engineer, React, Laravel, TypeScript"
    />
    <meta name="author" content="Danilo Arenas Yi" />
    <meta name="robots" content="index, follow" />
    <meta name="theme-color" content="#f5f5f5" />

    <!-- Canonical & Hreflang -->
    <link rel="canonical" href={`${SITE_URL}/`} />
    <link rel="alternate" hreflang="en" href={`${SITE_URL}/en/`} />
    <link rel="alternate" hreflang="es" href={`${SITE_URL}/es/`} />
    <link rel="alternate" hreflang="x-default" href={`${SITE_URL}/`} />

    <!-- Open Graph -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={`${SITE_URL}/`} />
    <meta property="og:title" content="Danilo Arenas Yi — Fullstack Developer" />
    <meta property="og:description" content="Fullstack Developer Portfolio of Danilo Arenas Yi (DJAYI). React, Laravel, TypeScript specialist." />
    <meta property="og:image" content={`${SITE_URL}/og-image.jpg`} />
    <meta property="og:site_name" content="Danilo Arenas Yi — Portfolio" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Danilo Arenas Yi — Fullstack Developer" />
    <meta name="twitter:description" content="Fullstack Developer Portfolio of Danilo Arenas Yi (DJAYI)." />
    <meta name="twitter:image" content={`${SITE_URL}/og-image.jpg`} />

    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Major+Mono+Display&family=Michroma&display=swap"
      rel="stylesheet"
    />

    <!-- Structured Data (JSON-LD) -->
    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "Danilo Arenas Yi — Portfolio",
      "url": SITE_URL,
      "inLanguage": ["es", "en"],
      "author": {
        "@type": "Person",
        "name": "Danilo Arenas Yi",
        "alternateName": "DJAYI",
        "jobTitle": "Fullstack Developer",
        "sameAs": [
          "https://www.linkedin.com/in/daryi/",
          "https://github.com/DJAYI"
        ]
      }
    })} />

    <meta name="generator" content={Astro.generator} />
  </head>
  <body class="m-0 p-0 overflow-hidden">
    <!-- Hint del idioma preferido detectado en el servidor -->
    <input type="hidden" id="preferred-locale" value={preferredLocale ?? ""} />

    <div
      id="lang-selector"
      class="fixed inset-0 z-50 flex overflow-hidden"
      style="visibility: hidden;"
    >
      <!-- EN side -->
      <button
        id="en-side"
        class="lang-side h-full bg-neutral-100 flex items-center justify-center cursor-pointer border-none outline-none overflow-hidden"
        style="width: 50%;"
        data-lang="en"
      >
        <div class="text-center pointer-events-none select-none">
          <span
            class="font-header text-7xl md:text-[10rem] text-neutral-900 block lang-text leading-none"
          >
            En
          </span>
          <p
            class="font-michroma text-sm md:text-lg text-neutral-500 mt-4 md:mt-6 lang-sub"
          >
            English
          </p>
        </div>
      </button>

      <!-- ES side -->
      <button
        id="es-side"
        class="lang-side h-full bg-neutral-900 flex items-center justify-center cursor-pointer border-none outline-none overflow-hidden"
        style="width: 50%;"
        data-lang="es"
      >
        <div class="text-center pointer-events-none select-none">
          <span
            class="font-header text-7xl md:text-[10rem] text-neutral-100 block lang-text leading-none"
          >
            Es
          </span>
          <p
            class="font-michroma text-sm md:text-lg text-neutral-400 mt-4 md:mt-6 lang-sub"
          >
            Español
          </p>
        </div>
      </button>
    </div>

    <script>
      import { gsap } from "gsap";

      const selector = document.getElementById("lang-selector")!;
      const enSide = document.getElementById("en-side")!;
      const esSide = document.getElementById("es-side")!;

      // Auto-redirect si ya eligió idioma antes
      const saved = localStorage.getItem("portfolio-lang");
      if (saved === "en" || saved === "es") {
        window.location.replace(`/${saved}/`);
      } else {
        // Usar hint del servidor (Accept-Language) para posible redirección automática
        const preferredEl = document.getElementById("preferred-locale") as HTMLInputElement;
        const preferred = preferredEl?.value;

        // Si tenemos preferencia del servidor, redirigir automáticamente
        // (solo si no ha visitado antes — localStorage vacío)
        if (preferred === "en" || preferred === "es") {
          localStorage.setItem("portfolio-lang", preferred);
          window.location.replace(`/${preferred}/`);
        } else {
          // Mostrar selector con animación de entrada
          selector.style.visibility = "visible";

          gsap.from(".lang-text", {
            y: 60,
            opacity: 0,
            duration: 1.2,
            ease: "power3.out",
            stagger: 0.2,
            delay: 0.1,
          });

          gsap.from(".lang-sub", {
            y: 30,
            opacity: 0,
            duration: 0.8,
            ease: "power2.out",
            stagger: 0.2,
            delay: 0.5,
          });
        }
      }

      let isAnimating = false;

      function selectLanguage(lang: string) {
        if (isAnimating) return;
        isAnimating = true;
        localStorage.setItem("portfolio-lang", lang);

        const chosen = lang === "en" ? enSide : esSide;
        const other = lang === "en" ? esSide : enSide;
        const chosenText = chosen.querySelector(".lang-text")!;
        const chosenSub = chosen.querySelector(".lang-sub")!;

        const tl = gsap.timeline({
          onComplete: () => {
            window.location.href = `/${lang}/`;
          },
        });

        tl.to(other, {
          width: "0%",
          duration: 0.8,
          ease: "power3.inOut",
        })
          .to(
            chosen,
            {
              width: "100%",
              duration: 0.8,
              ease: "power3.inOut",
            },
            "<",
          )
          .to(
            chosenText,
            {
              scale: 1.4,
              duration: 0.8,
              ease: "power3.inOut",
            },
            "<",
          )
          .to(
            chosenSub,
            {
              opacity: 0,
              y: -20,
              duration: 0.4,
              ease: "power2.in",
            },
            "<",
          )
          .to(chosen, {
            opacity: 0,
            duration: 0.5,
            ease: "power2.in",
          });
      }

      enSide.addEventListener("click", () => selectLanguage("en"));
      esSide.addEventListener("click", () => selectLanguage("es"));

      // Hover: expansión sutil
      enSide.addEventListener("mouseenter", () => {
        if (isAnimating) return;
        gsap.to(enSide, { width: "55%", duration: 0.5, ease: "power2.out" });
        gsap.to(esSide, { width: "45%", duration: 0.5, ease: "power2.out" });
      });

      esSide.addEventListener("mouseenter", () => {
        if (isAnimating) return;
        gsap.to(esSide, { width: "55%", duration: 0.5, ease: "power2.out" });
        gsap.to(enSide, { width: "45%", duration: 0.5, ease: "power2.out" });
      });

      selector.addEventListener("mouseleave", () => {
        if (isAnimating) return;
        gsap.to(enSide, { width: "50%", duration: 0.5, ease: "power2.out" });
        gsap.to(esSide, { width: "50%", duration: 0.5, ease: "power2.out" });
      });
    </script>
  </body>
</html>
